<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin ‚Äî Atanu Mitra</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, orderBy, query, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytesResumable, getDownloadURL }
    from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDRc39r_GepYNr-hCt1fEzNcWy8r_Z0U0w",
    authDomain: "atanumitra-7ad17.firebaseapp.com",
    projectId: "atanumitra-7ad17",
    storageBucket: "atanumitra-7ad17.firebasestorage.app",
    messagingSenderId: "359751553651",
    appId: "1:359751553651:web:edc0a0b3b68d65f7d15006",
    measurementId: "G-HWX4J0Y82P"
  };

  const app  = initializeApp(firebaseConfig);
  const db   = getFirestore(app);
  const stor = getStorage(app);

  const ADMIN_EMAIL = "mramitra70@gmail.com";
  const ADMIN_PASS  = "amitra@70";

  window.checkLogin = (e, p) => e === ADMIN_EMAIL && p === ADMIN_PASS;

  window.fbDB = db;
  window.fbStor = stor;
  window.fbFns = { addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy, serverTimestamp,
    booksCol: () => collection(db, "books") };
  window.storFns = { ref, uploadBytesResumable, getDownloadURL };
</script>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:#0b0906;--surf:#131009;--surf2:#1a1610;--surf3:#211a0f;
  --gold:#c9943a;--amber:#f0c060;--text:#ece4d4;--muted:#8a8070;
  --border:rgba(201,148,58,.15);--red:#9b3a2a;--green:#2d6a4f;
}
body{font-family:'Jost',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--gold);}

/* LOGIN */
#login{
  min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:var(--bg);
  background-image:
    radial-gradient(ellipse 60% 50% at 50% 45%,rgba(201,148,58,.06) 0%,transparent 65%);
}
.login-box{
  background:var(--surf);border:1px solid var(--border);
  width:400px;padding:56px 44px;
}
.login-logo{
  font-family:'Playfair Display',serif;
  font-size:13px;letter-spacing:3px;text-transform:uppercase;
  color:var(--gold);text-align:center;margin-bottom:8px;
}
.login-title{
  font-family:'Playfair Display',serif;
  font-size:32px;font-weight:400;color:var(--text);
  text-align:center;margin-bottom:36px;
}
.lf{margin-bottom:18px;}
.lf label{
  display:block;font-size:10px;letter-spacing:2px;text-transform:uppercase;
  color:var(--muted);margin-bottom:7px;
}
.lf input{
  width:100%;padding:13px 15px;
  background:var(--surf2);border:1px solid var(--border);
  color:var(--text);font-family:'Jost',sans-serif;font-size:14px;outline:none;
  transition:border-color .2s;
}
.lf input:focus{border-color:var(--gold);}
.login-btn{
  width:100%;padding:15px;margin-top:8px;
  background:var(--gold);color:var(--bg);border:none;
  font-family:'Jost',sans-serif;font-size:11px;letter-spacing:3px;text-transform:uppercase;font-weight:600;
  cursor:pointer;transition:background .2s;
}
.login-btn:hover{background:var(--amber);}
.login-err{
  font-size:13px;color:#e07060;text-align:center;margin-top:14px;display:none;
}

/* PANEL */
#panel{display:none;min-height:100vh;}

.anav{
  background:var(--surf);border-bottom:1px solid var(--border);
  padding:0 48px;height:62px;
  display:flex;align-items:center;justify-content:space-between;
}
.anav-brand{
  font-family:'Playfair Display',serif;
  font-size:18px;color:var(--text);
}
.anav-brand span{color:var(--gold);}
.anav-btns{display:flex;gap:12px;}
.abtn{
  padding:9px 22px;font-size:10px;letter-spacing:2px;text-transform:uppercase;
  cursor:pointer;border:none;font-family:'Jost',sans-serif;font-weight:600;
  transition:all .2s;
}
.abtn-outline{background:transparent;border:1px solid var(--border)!important;color:var(--muted);}
.abtn-outline:hover{border-color:var(--text)!important;color:var(--text);}
.abtn-gold{background:var(--gold);color:var(--bg);}
.abtn-gold:hover{background:var(--amber);}

.amain{display:grid;grid-template-columns:340px 1fr;min-height:calc(100vh - 62px);}

/* FORM PANEL */
.fpanel{
  background:var(--surf);border-right:1px solid var(--border);
  padding:32px 28px;overflow-y:auto;
}
.fp-title{
  font-family:'Playfair Display',serif;
  font-size:22px;color:var(--text);margin-bottom:26px;
  padding-bottom:14px;border-bottom:1px solid var(--border);
}
.fg{margin-bottom:18px;}
.fg label{
  display:block;font-size:10px;letter-spacing:2px;text-transform:uppercase;
  color:var(--muted);margin-bottom:6px;
}
.fg input,.fg textarea,.fg select{
  width:100%;padding:12px 14px;
  background:var(--surf2);border:1px solid var(--border);
  color:var(--text);font-family:'Jost',sans-serif;font-size:13px;outline:none;
  transition:border-color .2s;resize:vertical;
}
.fg input:focus,.fg textarea:focus,.fg select:focus{border-color:var(--gold);}
.fg select option{background:var(--surf2);}

.upload-zone{
  border:1.5px dashed rgba(201,148,58,.25);
  padding:22px;text-align:center;cursor:pointer;
  transition:all .2s;background:var(--surf2);position:relative;
}
.upload-zone:hover{border-color:var(--gold);background:rgba(201,148,58,.03);}
.upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.uicon{font-size:26px;margin-bottom:6px;}
.utxt{font-size:12px;color:var(--muted);}
.ubar{
  height:4px;background:var(--surf3);margin-top:12px;display:none;
  border-radius:2px;overflow:hidden;
}
.ubar-fill{height:100%;background:var(--gold);width:0%;transition:width .2s;}
.u-prev{width:100%;max-height:160px;object-fit:cover;display:none;margin-top:10px;border:1px solid var(--border);}

.sub-btn{
  width:100%;padding:14px;background:var(--gold);color:var(--bg);border:none;
  font-family:'Jost',sans-serif;font-size:11px;letter-spacing:2.5px;text-transform:uppercase;font-weight:600;
  cursor:pointer;transition:background .2s;margin-top:8px;
}
.sub-btn:hover{background:var(--amber);}
.sub-btn:disabled{background:var(--muted);cursor:not-allowed;}
.clr-btn{
  width:100%;padding:11px;background:transparent;border:1px solid var(--border);
  color:var(--muted);font-family:'Jost',sans-serif;font-size:10px;letter-spacing:2px;text-transform:uppercase;
  cursor:pointer;margin-top:8px;transition:all .2s;
}
.clr-btn:hover{border-color:var(--red);color:var(--red);}

.status{padding:11px 14px;font-size:13px;margin-top:11px;display:none;}
.st-ok{background:rgba(45,106,79,.12);color:#4ade80;border-left:3px solid #4ade80;}
.st-err{background:rgba(155,58,42,.12);color:#f87171;border-left:3px solid #f87171;}
.st-load{background:rgba(201,148,58,.1);color:var(--gold);border-left:3px solid var(--gold);}

/* LIST PANEL */
.lpanel{padding:32px 36px;overflow-y:auto;}
.lhd{display:flex;align-items:center;justify-content:space-between;margin-bottom:26px;}
.l-title{font-family:'Playfair Display',serif;font-size:26px;color:var(--text);}
.l-count{font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);}

.btable{width:100%;border-collapse:collapse;}
.btable th{
  text-align:left;font-size:10px;letter-spacing:2px;text-transform:uppercase;
  color:var(--muted);padding:10px 14px;border-bottom:1px solid var(--border);
}
.btable td{
  padding:14px;border-bottom:1px solid rgba(201,148,58,.06);
  font-size:13px;vertical-align:middle;
}
.btable tr:hover td{background:rgba(201,148,58,.03);}

.bk-cov{
  width:44px;height:58px;object-fit:cover;display:block;
  background:var(--surf3);border:1px solid var(--border);
}
.bk-cov-ph{
  width:44px;height:58px;background:var(--surf3);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  font-size:10px;color:var(--muted);text-align:center;
}
.bk-nm{
  font-family:'Playfair Display',serif;
  font-size:16px;color:var(--text);font-weight:500;
}
.bk-sub{font-size:11px;color:var(--muted);margin-top:2px;}
.badge{
  display:inline-block;padding:3px 10px;
  font-size:9px;letter-spacing:1.5px;text-transform:uppercase;font-weight:700;
}
.b-pub{background:var(--gold);color:var(--bg);}
.b-up{background:var(--red);color:#fff;}
.b-ac{background:var(--surf2);color:var(--gold);border:1px solid rgba(201,148,58,.3);}
.bk-url a{
  color:rgba(201,148,58,.7);text-decoration:none;font-size:11px;
  max-width:160px;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}
.bk-url a:hover{color:var(--gold);}

.act-btn{
  padding:6px 13px;font-size:10px;letter-spacing:1px;text-transform:uppercase;
  cursor:pointer;border:none;font-family:'Jost',sans-serif;font-weight:600;
  transition:all .2s;margin-right:4px;
}
.btn-ed{background:rgba(201,148,58,.12);color:var(--gold);}
.btn-ed:hover{background:var(--gold);color:var(--bg);}
.btn-del{background:rgba(155,58,42,.1);color:var(--red);}
.btn-del:hover{background:var(--red);color:#fff;}

.empty{
  text-align:center;padding:80px;
  font-family:'Playfair Display',serif;font-size:20px;font-style:italic;color:var(--muted);
}

@media(max-width:900px){
  .amain{grid-template-columns:1fr;}
  .fpanel{border-right:none;border-bottom:1px solid var(--border);}
  .anav{padding:0 18px;}
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <div class="login-box">
    <div class="login-logo">Atanu Mitra</div>
    <h1 class="login-title">Admin Panel</h1>
    <div class="lf">
      <label>Email Address</label>
      <input type="email" id="l-email" placeholder="your@email.com" />
    </div>
    <div class="lf">
      <label>Password</label>
      <input type="password" id="l-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
        onkeydown="if(event.key==='Enter')doLogin()" />
    </div>
    <button class="login-btn" onclick="doLogin()">Sign In ‚Üí</button>
    <div class="login-err" id="l-err">Invalid email or password. Please try again.</div>
  </div>
</div>

<!-- PANEL -->
<div id="panel">
  <nav class="anav">
    <div class="anav-brand">Atanu Mitra ‚Äî <span>Admin</span></div>
    <div class="anav-btns">
      <a href="index.html" target="_blank">
        <button class="abtn abtn-outline">View Website ‚Üó</button>
      </a>
      <button class="abtn abtn-outline" onclick="logout()">Logout</button>
    </div>
  </nav>

  <div class="amain">
    <!-- FORM -->
    <div class="fpanel">
      <h2 class="fp-title" id="fp-title">Add New Book</h2>
      <input type="hidden" id="edit-id" />

      <div class="fg">
        <label>Book Title *</label>
        <input type="text" id="f-title" placeholder="e.g. Kaler Mukhosh" />
      </div>
      <div class="fg">
        <label>Category</label>
        <select id="f-cat">
          <option value="fiction">Fiction</option>
          <option value="non-fiction">Non-Fiction</option>
          <option value="academic">Academic</option>
          <option value="poetry">Poetry</option>
          <option value="novel">Novel</option>
          <option value="short-stories">Short Stories</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="fg">
        <label>Status</label>
        <select id="f-status">
          <option value="published">Published</option>
          <option value="upcoming">Upcoming</option>
          <option value="academic">Academic</option>
        </select>
      </div>
      <div class="fg">
        <label>Year of Publication</label>
        <input type="text" id="f-year" placeholder="e.g. 2023" />
      </div>
      <div class="fg">
        <label>Publisher</label>
        <input type="text" id="f-pub" placeholder="e.g. Ananda Publishers" />
      </div>
      <div class="fg">
        <label>Description</label>
        <textarea id="f-desc" rows="4" placeholder="Brief description of the book..."></textarea>
      </div>
      <div class="fg">
        <label>Purchase URL (Amazon / Flipkart / other)</label>
        <input type="url" id="f-url" placeholder="https://amazon.in/..." />
      </div>
      <div class="fg">
        <label>Book Cover Image</label>
        <div class="upload-zone">
          <input type="file" id="f-cover" accept="image/*" onchange="previewImg(this)" />
          <div class="uicon">üñºÔ∏è</div>
          <div class="utxt">Click to upload cover image<br><small style="opacity:.6">JPG, PNG, WEBP ‚Äî stores in Firebase</small></div>
          <div class="ubar" id="ubar"><div class="ubar-fill" id="ubar-fill"></div></div>
        </div>
        <img id="u-prev" class="u-prev" alt="Preview" />
        <div id="cur-url" style="font-size:10px;color:var(--muted);margin-top:5px;display:none"></div>
      </div>

      <button class="sub-btn" id="sub-btn" onclick="submitBook()">Add Book ‚Üí</button>
      <button class="clr-btn" onclick="clearForm()">Clear Form</button>
      <div class="status" id="status"></div>
    </div>

    <!-- LIST -->
    <div class="lpanel">
      <div class="lhd">
        <h2 class="l-title">All Books</h2>
        <div class="l-count" id="l-count">Loading‚Ä¶</div>
      </div>
      <div id="list-area"><div class="empty">Loading‚Ä¶</div></div>
    </div>
  </div>
</div>

<script>
// AUTH
function doLogin(){
  const e=document.getElementById('l-email').value;
  const p=document.getElementById('l-pass').value;
  if(window.checkLogin&&window.checkLogin(e,p)){
    document.getElementById('login').style.display='none';
    document.getElementById('panel').style.display='block';
    loadBooks();
  } else {
    document.getElementById('l-err').style.display='block';
  }
}
function logout(){
  document.getElementById('login').style.display='flex';
  document.getElementById('panel').style.display='none';
  document.getElementById('l-email').value='';
  document.getElementById('l-pass').value='';
}

// IMAGE PREVIEW
function previewImg(inp){
  const f=inp.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=e=>{
    const p=document.getElementById('u-prev');
    p.src=e.target.result;p.style.display='block';
  };
  r.readAsDataURL(f);
}

// FIREBASE STORAGE UPLOAD with progress
async function uploadImage(file){
  const fns=window.storFns;
  const fileRef=fns.ref(window.fbStor, `book-covers/${Date.now()}_${file.name}`);
  return new Promise((resolve,reject)=>{
    const task=fns.uploadBytesResumable(fileRef,file);
    const bar=document.getElementById('ubar');
    const fill=document.getElementById('ubar-fill');
    bar.style.display='block';
    task.on('state_changed',
      snap=>{
        const pct=Math.round((snap.bytesTransferred/snap.totalBytes)*100);
        fill.style.width=pct+'%';
      },
      err=>{bar.style.display='none';reject(err);},
      async()=>{
        bar.style.display='none';
        const url=await fns.getDownloadURL(task.snapshot.ref);
        resolve(url);
      }
    );
  });
}

// STATUS
function showStatus(msg,type){
  const el=document.getElementById('status');
  el.textContent=msg;el.className=`status st-${type}`;el.style.display='block';
}

// SUBMIT
async function submitBook(){
  const title=document.getElementById('f-title').value.trim();
  if(!title){showStatus('Please enter a book title.','err');return;}
  const btn=document.getElementById('sub-btn');
  btn.disabled=true;
  showStatus('Saving‚Ä¶','load');
  try{
    let coverUrl=document.getElementById('cur-url').dataset.url||'';
    const fi=document.getElementById('f-cover');
    if(fi.files[0]){
      showStatus('Uploading image to Firebase‚Ä¶','load');
      coverUrl=await uploadImage(fi.files[0]);
    }
    const data={
      title,
      category:document.getElementById('f-cat').value,
      status:document.getElementById('f-status').value,
      year:document.getElementById('f-year').value,
      publisher:document.getElementById('f-pub').value,
      description:document.getElementById('f-desc').value,
      purchaseUrl:document.getElementById('f-url').value,
      coverUrl,
      updatedAt:window.fbFns.serverTimestamp()
    };
    const fns=window.fbFns;
    const editId=document.getElementById('edit-id').value;
    if(editId){
      await fns.updateDoc(fns.doc(window.fbDB,'books',editId),data);
      showStatus('‚úì Book updated successfully!','ok');
    } else {
      data.createdAt=fns.serverTimestamp();
      await fns.addDoc(fns.booksCol(),data);
      showStatus('‚úì Book added successfully!','ok');
    }
    clearForm();
    await loadBooks();
  } catch(err){
    console.error(err);showStatus('Error: '+err.message,'err');
  } finally{btn.disabled=false;}
}

// LOAD
async function loadBooks(){
  try{
    const fns=window.fbFns;
    const q=fns.query(fns.booksCol(),fns.orderBy('createdAt','desc'));
    const snap=await fns.getDocs(q);
    const books=[];
    snap.forEach(d=>books.push({id:d.id,...d.data()}));
    renderList(books);
  } catch(e){
    document.getElementById('list-area').innerHTML=`<div class="empty">Error: ${e.message}</div>`;
  }
}

function renderList(books){
  document.getElementById('l-count').textContent=`${books.length} Book${books.length!==1?'s':''}`;
  if(!books.length){
    document.getElementById('list-area').innerHTML=`<div class="empty">No books yet. Add your first book!</div>`;
    return;
  }
  const rows=books.map(b=>`
    <tr>
      <td>
        ${b.coverUrl
          ?`<img class="bk-cov" src="${b.coverUrl}" alt="" />`
          :`<div class="bk-cov-ph">No img</div>`}
      </td>
      <td>
        <div class="bk-nm">${b.title}</div>
        <div class="bk-sub">${b.year||''} ${b.publisher?'¬∑ '+b.publisher:''}</div>
      </td>
      <td><span class="badge b-${b.category==='academic'?'ac':'pub'}">${b.category||'‚Äî'}</span></td>
      <td><span class="badge ${b.status==='upcoming'?'b-up':b.status==='academic'?'b-ac':'b-pub'}">${b.status||'published'}</span></td>
      <td class="bk-url">
        ${b.purchaseUrl
          ?`<a href="${b.purchaseUrl}" target="_blank" title="${b.purchaseUrl}">${b.purchaseUrl}</a>`
          :`<span style="color:var(--muted)">‚Äî</span>`}
      </td>
      <td>
        <button class="act-btn btn-ed" onclick='editBook(${JSON.stringify(b).replace(/'/g,"&#39;")})'>Edit</button>
        <button class="act-btn btn-del" onclick="delBook('${b.id}')">Delete</button>
      </td>
    </tr>
  `).join('');
  document.getElementById('list-area').innerHTML=`
    <table class="btable">
      <thead><tr>
        <th>Cover</th><th>Title</th><th>Category</th><th>Status</th><th>Purchase URL</th><th>Actions</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

function editBook(b){
  document.getElementById('edit-id').value=b.id;
  document.getElementById('fp-title').textContent='Edit Book';
  document.getElementById('sub-btn').textContent='Update Book ‚Üí';
  document.getElementById('f-title').value=b.title||'';
  document.getElementById('f-cat').value=b.category||'fiction';
  document.getElementById('f-status').value=b.status||'published';
  document.getElementById('f-year').value=b.year||'';
  document.getElementById('f-pub').value=b.publisher||'';
  document.getElementById('f-desc').value=b.description||'';
  document.getElementById('f-url').value=b.purchaseUrl||'';
  if(b.coverUrl){
    const p=document.getElementById('u-prev');p.src=b.coverUrl;p.style.display='block';
    const cu=document.getElementById('cur-url');
    cu.textContent='Current cover saved';cu.style.display='block';cu.dataset.url=b.coverUrl;
  }
  document.querySelector('.fpanel').scrollTop=0;
}

async function delBook(id){
  if(!confirm('Delete this book? This cannot be undone.'))return;
  try{
    const fns=window.fbFns;
    await fns.deleteDoc(fns.doc(window.fbDB,'books',id));
    await loadBooks();
  } catch(e){alert('Error: '+e.message);}
}

function clearForm(){
  document.getElementById('edit-id').value='';
  document.getElementById('fp-title').textContent='Add New Book';
  document.getElementById('sub-btn').textContent='Add Book ‚Üí';
  ['f-title','f-year','f-pub','f-desc','f-url'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('f-cover').value='';
  document.getElementById('u-prev').style.display='none';
  document.getElementById('cur-url').style.display='none';
  document.getElementById('status').style.display='none';
}
</script>
</body>
</html>
